<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

	
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=utf-8">

	
	
  <title>netCDF/OPeNDAP interface to matlab</title>
  <meta name="GENERATOR" content="OpenOffice.org 2.0  (Linux)">

	
  <meta name="CREATED" content="20050922;13333800">

	
  <meta name="CHANGED" content="20061204;14553600">

	
  <meta name="DESCRIPTION" content="The CSIRO netCDF/OPeNDAP interface to matlab is used in a matlab session to retrieve data from local netCDF files or OPeNDAP servers. The interface has options for automatically handling missing values, scalefactors, and permutation of hyperslabs. It also has a simple syntax.">

	
  <meta name="KEYWORDS" content="CSIRO matlab netCDF OPeNDAP interface">

	
  <style>
	<!--
		H1 { color: #000000 }
		P { color: #000000 }
		PRE { color: #000000 }
		H3 { color: #000000 }
	-->
	</style>
</head>


<body dir="ltr" lang="en-AU" text="#000000">

<h1 align="center">The CSIRO netCDF/OPeNDAP interface to matlab</h1>

<p align="center"><font size="6"><b>Version 3.33</b></font></p>

<p align="center"><font size="6"><b>12 January 2007</b></font></p>

<p><a href="#Introduction"><font style="font-size: 16pt;" size="4">Introduction</font></a></p>

<p><a href="#Summary"><font style="font-size: 16pt;" size="4">Summary of
functions</font></a></p>

<ul>

	<li>
    <p><a href="#inqnc"><font style="font-size: 16pt;" size="4">inqnc</font></a></p>

	</li>
  <li>
    <p><a href="#getnc"><font style="font-size: 16pt;" size="4">getnc</font></a></p>

	</li>
  <li>
    <p><a href="#timenc"><font style="font-size: 16pt;" size="4">timenc</font></a></p>

	</li>
  <li>
    <p><a href="#attnc"><font style="font-size: 16pt;" size="4">attnc</font></a></p>

	</li>
  <li>
    <p><a href="#ddsnc"><font style="font-size: 16pt;" size="4">ddsnc</font></a></p>

	</li>
  <li>
    <p><a href="#whatnc"><font style="font-size: 16pt;" size="4">whatnc</font></a></p>

  </li>
</ul>

<p><a href="#Installation"><font style="font-size: 16pt;" size="4">Installation</font></a></p>

<p><a href="#Portability"><font style="font-size: 16pt;" size="4">Portability
and known problems</font></a></p>

<p><a href="#Revision"><font style="font-size: 16pt;" size="4">Revision
history</font></a></p>

<p><a href="#Alternative"><font style="font-size: 16pt;" size="4">Alternative
ways of accessing netCDF and OPeNDAP data</font></a></p>

<p><a href="#Disclaimer"><font style="font-size: 16pt;" size="4">Disclaimer</font></a></p>

<p><a href="#People"><font style="font-size: 16pt;" size="4">People
involved in the development of the interface</font></a></p>

<p><a href="#Contact"><font style="font-size: 16pt;" size="4">Contact
details</font></a></p>

<p><a href="#links"><font style="font-size: 16pt;" size="4">Matlab links</font></a></p>

<hr>
<h1><a name="Introduction"></a>Introduction</h1>

<p>The CSIRO interface is used in a <a href="http://www.mathworks.com/">matlab</a>
session to retrieve data from either a local <a href="http://www.unidata.ucar.edu/software/netcdf/">netCDF</a>
file or via an <a href="http://opendap.org/">OPeNDAP/DODS</a> server.
The same commands are used for either type of access in almost every
case (some small differences are discussed <a href="#Portability">here</a>).</p>

<p><font size="3">The interface has options for automatically handling
missing values, scalefactors, and the permutation of hyperslabs. It
also has a simple syntax.</font></p>

<p>The method of installing the software is described <a href="#Installation">here</a>.</p>

<p>There are other ways of accessing netCDF files and OPeNDAP/DODS
data and some of them are discussed briefly <a href="#Alternative">here</a>.</p>

<hr>
<h1><a name="Summary"></a>Summary of functions</h1>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">Basic
functions</font></font></p>

<p>There are six basic functions which are used to access datasets
either from locally held netCDF files or via an OPeNDAP/DODS server.</p>

<p>If dealing with a netCDF file then the first argument to each
function will be a file name. For example,
'/home/netcdf-data/sst_cac_recon_ltm.nc' is a full file name
(including a path) to a certain netCDF file at the CSIRO Marine Labs.
The same file is available via an OPeNDAP/DODS server with the url
'<a href="http://www.marine.csiro.au/dods/nph-dods/dods-data/climatology-netcdf/sst_cac_recon_ltm.nc.html">http://www.marine.csiro.au/dods/nph-dods/dods-data/climatology-netcdf/sst_cac_recon_ltm.nc</a>'.
In the examples that follow we will use this file.</p>

<p>The six basic functions are:</p>

<ul>

	<li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" align="left"><a href="#inqnc"><font style="font-size: 16pt;" size="4">inqnc</font></a>
	: interactive inquiry of the dataset</p>

  </li>
</ul>

<ul>

	<li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" align="left"><a href="#getnc"><font style="font-size: 16pt;" size="4">getnc</font></a>
	: imports variables from the dataset</p>

  </li>
</ul>

<ul>

	<li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" align="left"><a href="#timenc"><font style="font-size: 16pt;" size="4">timenc</font></a>
	: imports the time vector of the dataset</p>

  </li>
</ul>

<ul>

	<li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" align="left"><a href="#attnc"><font style="font-size: 16pt;" size="4">attnc</font></a>
	: imports attributes from the dataset</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" align="left"><a href="#ddsnc"><font style="font-size: 16pt;" size="4">ddsnc</font></a>
	: returns information about the dataset</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" align="left"><a href="#whatnc"><font style="font-size: 16pt;" size="4">whatnc</font></a>
	: lists netCDF files in current directory</p>

  </li>
</ul>

<p>For a more detailed description of the functions and some examples
just follow the links. For an introduction it is suggested that you
look at the functions in the order that they are listed above. Of
course documentation is also available using the matlab help
facility.</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">Auxiliary
functions</font></font></p>

<p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">There are also some auxiliary
functions which are listed below. Use the matlab help facility for a
more detailed description of them. You will not usually want to call
these directly although some of the time related functions may be
useful on occasion.</p>

<ul>

	<li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">check_nc : checks whether a
	netcdf or OPeNDAP file is accessible</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">check_st : checks if a string
	is stored in a cell or character array</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">fill_att : returns the names
	of the attributes of a variable</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">fill_var : fills a row of an
	array with the name of a variable</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">get_calendar_date : converts
	Julian day numbers to calendar dates</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">get_day_of_week : gets the
	day of the week given the Julian day number</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">get_dods_dds : finds the
	Dataset Descriptor Structure (DDS) for a DODS/OPeNDAP data set</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">get_julian_day : converts
	calendar dates to Julian day numbers</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">getnc_s : command line
	version of getnc</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">get_serial_time : find the
	absolute time value given a relative time</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">gregorian : converts Julian
	day numbers to Gregorian calendar date</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">hms2h: converts hours,
	minutes, and seconds to hours</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">julian : converts Gregorian
	calendar dates to Julian day numbers</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">loaddap : direct calls to get
	DODS/OPeNDAP data and metadata</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">menu_old : generate a menu of
	choices for user input</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">mexnc : direct calls to
	netcdf functions</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">parsetnc : parses the COARDS
	string that specifies time units</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">pos_cds : returns the path to
	the common data set directory</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">return_v : prints out a
	string to prompt the user for keyboard input</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">s2hms : converts seconds to
	integer hour,minute,seconds</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">tmexnc : test of mexnc
	Mex-file interface to NetCDF</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">uncmp_nc : offers to
	uncompress a netCDF file</p>

	</li>
  <li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">y_rescal : returns the
	scalars rescale_var and rescale_att</p>

  </li>
</ul>

<ul>

	<li>
    <p style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;">whatnc : lists netCDF files
	in current directory</p>

  </li>
</ul>

<hr>
<h1><a name="inqnc"></a>inqnc</h1>

<p>inqnc is an interactive function that is used to find out about
the structure of a netCDF file or OPeNDAP dataset. In the latter case
you could use a web browser for the same purpose. Try clicking on the
url
'<a href="http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc.html">http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc</a>'&nbsp;
to see this structure. The same information is found in the matlab
example below. Of course, the output from inqnc will be almost
identical if we look at the netCDF file on a local disk.</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">Example</font></font></p>

<pre>&gt;&gt; file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; inqnc(file)<br> --- Global attributes ---<br>source: Test program<br> <br>The 5 dimensions are 1) dim_unlmited = 3 2) depth1 = 12 3) depth2 = 11 4) dim3 = 3 5) dim4 = 4.<br>dim_unlmited is unlimited in length<br> <br>----- Get further information about the following variables -----<br> <br> -1) None of them (no further information)<br> 0) All of the variables<br> 1) time 2) u 3) ureverse<br> 4) uchar1 5) uchar2 6) uchar3<br> 7) ushort 8) ulong 9) udouble<br> 10) no_atts 11) big_var 12) depth1<br> 13) depth2 14) dim3 <br> <br>Select a menu number: 1<br> <br> --- Information about time(dim_unlmited ) ---<br> <br>*units: days since 1990-1-1 00:00:0.0 *long_name: Time<br> <br>----- Get further information about the following variables -----<br> <br> -1) None of them (no further information)<br> 0) All of the variables<br> 1) time 2) u 3) ureverse<br> 4) uchar1 5) uchar2 6) uchar3<br> 7) ushort 8) ulong 9) udouble<br> 10) no_atts 11) big_var 12) depth1<br> 13) depth2 14) dim3 <br> <br>Select a menu number: 2<br> --- Information about u(depth1 depth2 ) ---<br> <br>*long_name: u,5_januarys *units: cm/sec<br>*ml__FillValue: 10000000270000000 *missing_value: 10000000270000000 <br>*valid_range: -10000000270000000 10000000270000000 <br>*test_double: 100 2000 *test_short: 25 -3 19 <br>*test_long: -4 333 -17 *scale_factor: 3 <br>*add_offset: 0.5 <br> <br>----- Get further information about the following variables -----<br> <br> -1) None of them (no further information)<br> 0) All of the variables<br> 1) time 2) u 3) ureverse<br> 4) uchar1 5) uchar2 6) uchar3<br> 7) ushort 8) ulong 9) udouble<br> 10) no_atts 11) big_var 12) depth1<br> 13) depth2 14) dim3 <br> <br>Select a menu number: -1</pre>

<hr>
<h1><a name="getnc"></a>getnc</h1>

<h3><a name="Introduction_getnc"></a><b>Introduction</b></h3>

<p>getnc retrieves data in two ways. It can be used&nbsp;<a href="#getnc_interactive">used
interactively</a> to retrieve data from a netCDF file.<br>
<br>
getnc
is more commonly used as a function call - it can then retrieve data
from both netCDF and OPeNDAP files. Because many options&nbsp;are
available&nbsp;getnc can take up to 11 <a href="#getnc_meanings_defaults">input
arguments</a> (although most have default values). To make things
easier for the user there are <a href="#getnc_specifying_arguments">various
ways of specifying</a> these arguments. Finally, a number of <a href="#getnc_examples">examples</a>
are given.</p>

<h3><a name="getnc_interactive"></a><b>Interactive use</b></h3>

<p>To retrieve data interactively the user simply types in&nbsp; 
</p>

<pre style="margin-bottom: 0.5cm;">&gt;&gt; val = getnc(file);</pre>
<p>
where file is a string containing the name of the netCDF file. From
there the user is prompted for more information.</p>

<h3><a name="getnc_meanings_defaults"></a><b>Arguments - meanings and
defaults</b></h3>

<p>There are 11 variables that getnc must know. Don't be frightened
however as there are some easy ways to specify them and all but two
have defaults. The variables are:</p>

<ol>

	<li>
    <p style="margin-bottom: 0cm;"><b>file</b>: This is a string
	containing the name of the netCDF file or the URL to the OPeNDAP
	dataset. It does not have a default. If describing a netCDF file it
	is permissible to drop the ".nc" prefix but this is not
	recommended. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>varid: &nbsp;</b>This may be a
	string or an integer. If it is a string then it should be the name
	of the variable in the netCDF file or OPeNDAP dataset. The use of an
	integer is a deprecated way of accessing netCDF file data; if used
	the integer then must be the menu number of the n dimensional
	variable as shown by a call to inqnc. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>bl_corner: </b>This is a vector
	of length n specifying the hyperslab corner&nbsp;with the lowest
	index values (the bottom left-hand corner in a 2-space).&nbsp; The
	corners refer to the dimensions in the same order that these
	dimensions are listed in the inqnc description of the&nbsp;variable.
	For a netCDF file this is the same order that they are&nbsp;returned
	in a call to "ncdump". With an OPeNDAP dataset it is
	the&nbsp;same order as in the DDS. Note also that the
	indexing&nbsp;starts with 1 - as in matlab and fortran, NOT 0 as in
	C. A negative element means that all values in&nbsp;that direction
	will be returned.&nbsp; If a negative scalar (or an empty array) is
	used this&nbsp;means that all of the elements in the array will be
	returned. This is the default, i.e., all of the elements of varid
	will be returned. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>tr_corner: </b>This is a vector
	of length n specifying the hyperslab corner with the highest index
	values (the top right-hand corner in a 2-space). A negative element
	means that the returned hyperslab should run to the highest possible
	index (this is the default). Note, however, that the value of an
	element in the end_point vector will be ignored if the corresponding
	element in the corner vector is negative. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>stride: </b>This is a vector of
	length n specifying the interval between accessed values of the
	hyperslab (sub-sampling) in each of the n dimensions.&nbsp; A value
	of 1 accesses adjacent values in the given dimension; a value of 2
	accesses every other value; and so on. If&nbsp;no sub-sampling is
	required in any direction then it is allowable&nbsp;to just pass the
	scalar 1 (or -1 to be consistent with the corner&nbsp;and end_point
	notation). Note, however, that the value of an&nbsp;element in the
	stride vector will be ignored if the corresponding&nbsp;element in
	the corner vector is negative. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>order:&nbsp;</b> 
	</p>

	
    <ul>

		<li>
        <p style="margin-bottom: 0cm;">order == -1 then the n dimensions
		of the array will be returned&nbsp;in the same order&nbsp;as
		described by a call to inqnc(file)&nbsp;or "ncdump". It
		therefore corresponds to the order in which the indices are
		specified in corner, end_point and stride. This is the default. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">order == -2 will reverse the
		above order. Because&nbsp;matlab's array storage is row-dominant
		this is actually a little quicker but the difference is rarely
		significant. 
		</p>

	</li>
    </ul>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>change_miss:&nbsp;</b>Missing
	data are indicated by the attributes _FillValue, missing_value,
	valid_range, valid_min and valid_max. The action to be taken with
	these data are determined by change_miss. 
	</p>

	
    <ul>

		<li>
        <p style="margin-bottom: 0cm;">change_miss == 1 causes missing
		values to be returned unchanged. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">change_miss == 2 causes missing
		values to be changed to NaN (the default). 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">change_miss == 3 causes missing
		values to be changed to new_miss (after rescaling if that is
		necessary). 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">change_miss &lt; 0 produces the
		default (missing values to be changed to NaN). 
		</p>

	</li>
    </ul>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>new_miss:&nbsp;</b>This is the
	value given to missing data if change_miss == 3. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>squeeze_it: </b>This specifies
	whether the matlab function "squeeze" should be applied to
	the returned array. This will eliminate any singleton
	array&nbsp;dimensions and possibly cause the returned array to have
	less dimensions than the full array. 
	</p>

	
    <ul>

		<li>
        <p style="margin-bottom: 0cm;">squeeze_it ~= 0 causes the
		squeeze function to&nbsp;be applied.&nbsp; This is the default.
		Note also that a 1-d array is returned as a column vector. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">squeeze_it == 0 so that squeeze
		will not be applied. 
		</p>

	</li>
    </ul>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><a name="rescale_opts"></a><b>rescale_opts:
	</b>This is a 2 element vector specifying whether or not rescaling
	is carried out on retrieved variables and certain attributes. The
	relevant attributes&nbsp;are _FillValue', 'missing_value',
	'valid_range',&nbsp;'valid_min' and 'valid_max'; they are used to
	find missing values of the relevant variable. The option was put in
	to deal with files that do not follow the <a href="http://www.unidata.ucar.edu/software/netcdf/docs/BestPractices.html">netCDF
	conventions</a> (usually because the creator of the file has
	misunderstood the convention). For further discussion of the problem
	see <a href="#Confusion">here</a>. <i><u>Only use this option if you
	are sure that you know what you are doing</u>.</i> 
	</p>

	
    <ul>

		<li>
        <p style="margin-bottom: 0cm;">rescale_opts(1) == 1 causes a
		variable read in by getnc.m to be rescaled by 'scale_factor' and&nbsp;
		'add_offset' if these are attributes of the variable; this is the
		default. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">rescale_opts(1) == 0 disables
		rescaling of the retrieved variable. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">rescale_opts(2) == 1 causes the
		attributes '_FillValue', etc to be rescaled by 'scale_factor' and
		'add_offset'; this is the default. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">rescale_opts(2)&nbsp;== 0
		disables the rescaling of the attributes '_FillValue', etc.</p>

	</li>
    </ul>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b>err_opt: </b>This is an integer
	that controls the error handling in a call to getnc.</p>

	
    <ul>

		<li>
        <p style="margin-bottom: 0cm;">err_opt == 0 on error this prints
		an error message and&nbsp;aborts. 
		</p>

		</li>
      <li>
        <p style="margin-bottom: 0cm;">err_opt == 1 prints a warning
		message and then returns an empty array. This is the default. 
		</p>

		</li>
      <li>
        <p>err_opt == 2 returns an empty array. <u><i>This is a
		dangerous option and should only be used with caution</i></u>. It
		might be used when&nbsp;getnc is called in a loop and you want to
		do your own error handling without being bothered by warning
		messages. 
		</p>

	</li>
    </ul>

  </li>
</ol>

<h3><a name="getnc_specifying_arguments"></a><b>Arguments - ways of
specifying</b></h3>

<p><br>
Specifying up to 11 arguments to getnc can be complicated and
confusing. To make the process easier getnc will accept a variety of
types of input. These are given as follows:</p>

<ul>

	<li>
    <p><b>Specify all 11 arguments</b>.&nbsp;Thus we could make a
	call like: 
	</p>

  </li>
</ul>

<p style="margin-left: 1.06cm;">&gt;&gt; values = getnc(file, varid,
bl_corner, tr_corner, stride, order, change_miss, new_miss,
squeeze_it, rescale_opts, err_opt);</p>

<ul>

	<li>
    <p><b>Use default arguments</b>. Only the first 2 arguments are
	strictly necessary as the other arguments all have defaults. The
	following call would retrieve the entire contents of the named
	variable: 
	</p>

  </li>
</ul>

<pre style="margin-left: 1.06cm; margin-bottom: 0.5cm;">&gt;&gt; values = getnc(file, varid);</pre>
<p style="margin-left: 1.06cm;">
If you want non-default behaviour for one or more of the later
arguments then you can do something like:</p>

<pre style="margin-left: 1.06cm; margin-bottom: 0.5cm;">&gt;&gt; values = getnc(file, varid, -1, -1, -1, -1, change_miss, new_miss);</pre>
<p style="margin-left: 1.06cm;">
In this case there are 4 arguments specified and 7 with default
values used.</p>

<ul>

	<li>
    <p><b>Use a structure as an argument.</b> From version 3.3
	onwards it is possible to pass a structure to getnc. This is
	illustrated below: 
	</p>

  </li>
</ul>

<pre style="margin-left: 1.06cm;">&gt;&gt; x.file = 'fred.nc';<br>&gt;&gt; x.varid = 'foo';<br>&gt;&gt; x.change_miss = 1;<br>&gt;&gt; values = getnc(x);</pre>
<p style="margin-left: 1.06cm;">
This specifies 3 arguments and causes defaults to be used for the
other 8.<br>
Note that it is possible to mix the usual arguments with
the passing of a structure - it is only necessary that the structure
be the last argument passed. We could achieve the same effect as
above by doing:</p>

<pre style="margin-left: 1.06cm;">&gt;&gt; x.change_miss = 1;<br>&gt;&gt; values = getnc('fred.nc', 'foo', x);</pre>
<h3>
<a name="getnc_examples"></a><b>Examples</b></h3>

<p>In the following examples we use our standard OPeNDAP file
"http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc"
to illustrate the usage of getnc 
</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get an entire
	array</font></font> 
	</p>

  </li>
</ul>

<p>The simplest command line call to make is the following:</p>

<pre>&gt;&gt; file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; u = getnc(file, 'u');</pre>
<p>
The first argument specified is the file name or url. The second
argument is the name of the variable - we could have found this by
using inqnc. The result is that the entire contents of the <i>u</i>
variable will be returned to the matlab session.</p>

<p>Alternatively we could have passed a structure to getnc to get the
same answer.</p>

<pre>&gt;&gt; x.file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; x.varid = 'u';<br>&gt;&gt; u = getnc(x);</pre>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get part of an
	array</font></font> 
	</p>

  </li>
</ul>

<p>We may only want a part of the variable and that is what the 3
arguments (<i>bl_corner, tr_corner, stride</i>) are about. If we use
inqnc to consider the <i>u</i> variable described in our example file
we see that it has two dimensions (<i>(depth1 depth2</i>) in that
order. We say that the variable is in a 2-dimensional rectangle. We
also saw that there are 12 and 11 points in each of the directions.
Thus we can imagine extracting a subset of the data known as a
hyperslab. The argument <i>bl_corner</i> specifies the bottom left
hand corner of the hyperslab, <i>tr_corner</i> specifies the top
right-hand corner and <i>stride</i> specifies the sampling done. An
example to illustrate this is shown below.</p>

<pre>&gt;&gt; u = getnc(file, 'u', [-1 3], [-1 9], [-1 2]);<br>&gt;&gt; size(u)<br>ans =<br> 12 4</pre>
<p>
The 1<sup>st</sup> element in each of these arguments is -1 to
indicate that we want to retrieve every point in that direction.
Hence the 1<sup>st</sup> dimension of <i>u </i>is of length 12 &ndash;
the full number of elements in the <i>depth1</i> dimension. Now
<i>bl_corner</i>(2) = 3, <i>tr_corner</i>(2) = 9 and <i>stride</i>(2)
= 2. This means that in the <i>depth2</i> direction we want every
secondpoint from the 3<sup>rd</sup> to the 9<sup>th</sup>, i.e.,
points 3, 5, 7 and 9. Hence the 2<sup>nd</sup> dimension of <i>u</i>
is of length 4.</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Changing the
	order of the dimensions in the returned array</font></font> 
	</p>

  </li>
</ul>

<p>The next argument to discuss is <i>order. </i>In general it is
best not use this option and just use the default (-1). The option
allows you to reverse the dimensions in the returned value. Since
netCDF files store data in row-major order but matlab does the
opposite, it is possible, in principle, to make some efficiencies
when retrieving data from a local netCDF file. However this is rarely
significant and the option is only retained for backwards
compatibility with older versions of getnc. (For OPeNDAP files
setting <i>order</i> = -2 is always less efficient than -1.) 
</p>

<p>The following example illustrates this.</p>

<pre>&gt;&gt; u = getnc(file, 'u'); <br>&gt;&gt; size(u)<br>ans =<br> 12 11<br>&gt;&gt; ut = getnc(file, 'u', -1, -1, -1, -2);<br>&gt;&gt; size(ut) <br>ans =<br> 11 12</pre>
<p>
Note that in the 2<sup>nd</sup> case we have used -1, -1, -1 for the
<i>corner, end_point, stride </i>arguments to indicate that we want
the default case of getting all possible values. We could have passed
a structure to get the same result as below:</p>

<pre>&gt;&gt; x.file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; x.varid = 'u';<br>&gt;&gt; x.order = -2;<br>&gt;&gt; ut = getnc(x); <br>&gt;&gt; size(ut)<br>ans =<br> 11 12</pre>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Missing Values</font></font>
		</p>

  </li>
</ul>

<p>The default behaviour of getnc is to replace missing values in the
data with NaNs. (By missing values we mean those values equal to the
<i>_FillValue</i> or <i>missing_value</i> attribute or outside the
range determined by the <i>valid_min</i>, <i>valid_max</i> or
<i>valid_range</i> attribute. This is discussed in the netCDF user's
guide at
<a href="http://www.unidata.ucar.edu/software/netcdf/docs/netcdf/Attribute-Conventions.html#Attribute-Conventions">http://www.unidata.ucar.edu/software/netcdf/docs/netcdf/Attribute-Conventions.html#Attribute-Conventions</a>.)
The pair of arguments <i>change_miss</i> and <i>new_miss</i> can
change this. If <i>change_miss</i> = 1 then any missing values are
returned unchanged. If <i>change_miss</i> = 2 then they are changed
to a NaN (the default, also available as <i>change_miss</i> = -1). If
<i>change_miss</i> = 3 then any missing values are replaced by
<i>new_miss.</i></p>

<p style="font-style: normal;">This is illustrated in the following
example &ndash; note that we pass a structure, x, here and have made sure
that x is empty at the start.</p>

<pre>&gt;&gt; x = [];<br>&gt;&gt; x.file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; x.varid = 'u';<br>&gt;&gt; x.bl_corner = [12 11];<br>&gt;&gt; x.tr_corner = [12 11];<br>&gt;&gt; u = getnc(x)<br>u =<br> NaN</pre>
<p>
We use the simplest version of <i>getnc</i> to retrieve the last
value of the array &ndash; we get a NaN because the value actually stored
in the dataset is marked as a missing value. Next we try&nbsp;<i>change_miss</i>
= 1,</p>

<pre>&gt;&gt; x.change_miss = 1;<br>&gt;&gt; u = getnc(x) <br>u =<br> 3.0000e+16</pre>
<p>
Now, 3.0000e+16, the value actually stored in the file, is returned.
Finally, we use <i>change_miss</i> = 3 to cause the missing value to
be replaced by 1.5 in our matlab array.</p>

<pre>&gt;&gt; x.change_miss = 3;<br>&gt;&gt; x.new_miss = 1.5;<br>&gt;&gt; u = getnc(x) <br>u =<br> 1.5000</pre>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Singleton
	dimensions</font></font> 
	</p>

  </li>
</ul>

<p>The next argument, <i>squeeze_it</i>, deals with singleton
dimensions (i.e., those of length 1). If <i>squeeze_it</i> = 1 (the
default behaviour) then any singleton dimension will be eliminated as
if the matlab function squeeze had been applied. If <i>squeeze_it</i>
= 0 then the singleton dimensions will remain. This is illustrated in
the following examples. 
</p>

<pre>&gt;&gt; big_var = getnc(file, 'big_var', [-1 2 2 5 -1], [-1 2 2 5 -1]);<br>&gt;&gt; size(big_var)<br>ans =<br> 12 3<br>&gt;&gt; big_var = getnc(file, 'big_var', [-1 2 2 5 -1], [-1 2 2 5 -1], -1, -1, -1, -1, 0);<br>&gt;&gt; size(big_var)<br>ans =<br> 3 1 1 1 12</pre>
<p>
This option is not really necessary any more because matlab has the
squeeze function. It was originally put in to enable backwards
compatibility with earlier versions of <i>getnc </i>written before
matlab dealt with multi-dimensional arrays and so we are stuck with
it.</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Error handling</font></font>
		</p>

  </li>
</ul>

<p>From version 3.3 onwards getnc has given the user some control
over error handling. In the examples below we ask for a non-existent
variable. The default behaviour (err_opt == 2) returns an empty array
and prints a warning message as below.</p>

<pre>&gt;&gt; junk = getnc(file, 'junk')<br>WARNING: junk is not a variable in http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc<br>junk =<br> []</pre>
<p>
Setting err_opt == 1 causes getnc to be aborted due to the
non-existent variable as seen below.</p>

<pre>&gt;&gt; x = []; <br>&gt;&gt; x.err_opt = 1; <br>&gt;&gt; junk = getnc(file, 'junk', x)<br>??? Error using ==&gt; getnc_s&gt;error_handle<br>ERROR: junk is not a variable in http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc<br>Error in ==&gt; getnc_s at 872<br> values = error_handle([], mess_str, [], err_opt);<br>Error in ==&gt; getnc at 211<br> values = getnc_s(varargin);</pre>
<p>
Finally, can see the dangerous option err_opt == 3 which causes an
empty array to be returned and no error message.</p>

<pre>&gt;&gt; x.err_opt = 3; <br>&gt;&gt; junk = getnc(file, 'junk', x)<br>junk =<br> []</pre>
<p style="margin-bottom: 0cm;">
This might be used when getnc is called in a loop and you don't want
to get a large number of error messages. Of course you should be
careful to handle the returned values properly.</p>

<hr>
<h1><a name="timenc"></a>timenc</h1>

<p>timenc finds the time vector and the corresponding base date for a
netCDF file or DODS/OPeNDAP dataset that follows the <a href="http://ferret.wrc.noaa.gov/noaa_coop/coop_cdf_profile.html">COARDS
conventions</a>. In practice this means that time-like variable
should have a units attribute of a certain form. An example is: 
</p>

<p><b>'seconds since 1992-10-8 15:15:42.5 -6:00'.</b></p>

<p style="font-style: normal;">This indicates seconds since October
8th, 1992 at 3 hours, 15 minutes and 42.5 seconds in the afternoon in
the time zone which is six hours to the west of Coordinated Universal
Time (i.e. Mountain Daylight Time). The time zone specification can
also be written without a colon using one or two-digits (indicating
hours) or three or four digits (indicating hours and minutes).
Instead of 'seconds' the string may contain 'minutes', 'hours',
'days' and 'weeks' and all of these may be singular or plural and
have capital first letters. The letters 'UTC' or 'UT' are allowed at
the end of the string, but these are ignored.</p>

<p>It is possible to have many different types of calendars but
timenc only implements five at present.</p>

<p>These are necessary because there is some confusion with dates
before October 15 1582 when the <a href="http://en.wikipedia.org/wiki/Gregorian_calendar">Gregorian
calendar</a> was introduced. A problem also arises when the reference
date in the units attribute is before this. timenc deals with this by
recognising some of the <a href="http://www.cgd.ucar.edu/cms/eaton/cf-metadata/index.html">CF
conventions</a> and returns different answers depending on the value
of the calendar attribute of the time-like variable. Also, some
numerical models like to pretend that every year has the same number
of days - 365, 366 and 360 are all used.</p>

<ol>

	<li>
    <p>calendar = 'standard', 'gregorian' or is not specified. In
	this case the relevant calculations are done for the true Gregorian
	calendar as decreed by Pope Gregory XIII. This has a discontinuity
	<span style="text-decoration: none;">so</span> that the day after 4
	October 1582 is 15 October 1582. This is the calendar almost
	universally used today and what udunits works with today. timenc has
	worked this way since revision 1.10 in 2000.</p>

	</li>
  <li>
    <p>calendar = 'proleptic_gregorian'. In this case the relevant
	calculations are done using the matlab functions datenum and datevec
	which simply extend the way our present calendar works backwards
	into the past. This is called the <a href="http://en.wikipedia.org/wiki/Proleptic_Gregorian_Calendar">proleptic
	Gregorian calendar</a>. Accordingly, dates are continuous, i.e., the
	day after 4 October 1582 is 5 October 1582, but does NOT correspond
	to historical time anywhere. As well there is a year zero. timenc
	used to work this way before revision 1.10 in the year 2000 and I
	believe that udunits also did at some stage in the past.</p>

	</li>
  <li>
    <p>calendar == 'noleap', '365_day'. Here it is assumed that
	every year has 365 days.</p>

	</li>
  <li>
    <p>calendar == 'all_leap', '366_day'. Here it is assumed that
	every year has 366 days.</p>

	</li>
  <li>
    <p>calendar == '360_day'. Here it is assumed that every year has
	360 days and every month has 30 days.</p>

  </li>
</ol>

<p>Note that other values of the calendar attribute produce an error
message. This can usually be avoided by the user specifying the
calendar explicitly in the call to timenc.</p>

<p>The general form of a timenc call is:</p>

<p>[gregorian_time, serial_time, gregorian_base, serial_base, sizem,
serial_time_jd, serial_base_jd] = timenc(file, time_var, corner,
end_point);</p>

<p style="margin-bottom: 0cm;">A full description of the options can
be found by typing help timenc in matlab.</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="5">Examples</font></font></p>

<p>In the following examples we use our standard OPeNDAP file
sst_cac_recon_ltm.nc.</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get an entire
	array</font></font> 
	</p>

  </li>
</ul>

<p>The simplest command line call to make is the following:</p>

<pre>&gt;&gt; file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; [gregorian_time, serial_time] = timenc(file);</pre>
<p>
Note that since the time-like variable is named 'time' we did not
even have to put in its name. We now look at the matrix that contains
the gregorian time.</p>

<pre>&gt;&gt; gregorian_time(1, :)<br>ans =<br> 1.0e+03 *<br> 1.9900 0.0010 0.0010 0 0 0.0000<br>&gt;&gt; gregorian_time<br>ans =<br> 1990 1 1 0 0 0<br> 1990 1 2 0 0 0<br> 1990 2 10 12 0 0</pre>
<p>
Each row of the the matrix gregorian_time contains a time in year,
month, day, minute, hour, second format. Thus the last date is for
noon, 10 February, 1990. We can see the same thing by looking at the
vector serial_time.</p>

<pre>&gt;&gt; size(serial_time)<br>ans =<br> 3 1<br>&gt;&gt; datestr(serial_time)<br>ans =<br>01-Jan-1990 00:00:00<br>02-Jan-1990 00:00:00<br>10-Feb-1990 12:00:00</pre>
<p>
serial_time gives the time in the format used by matlab's functions
datenum, datevec and datestr. Thus we can use datestr to print out
the last date.</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get part of an
	array</font></font> 
	</p>

  </li>
</ul>

<p>Here we get the 1<sup>st</sup> and 2<sup>nd</sup> dates.</p>

<pre>&gt;&gt; [gregorian_time, serial_time] = timenc(file, 'time', 1, 2);<br>&gt;&gt; datestr(serial_time) <br>ans =<br>01-Jan-1990 00:00:00<br>02-Jan-1990 00:00:00</pre>

<hr>
<h1><a name="attnc"></a>attnc</h1>

<p>attnc returns selected attributes of a netcdf file or DODS/OPeNDAP
dataset. The first form of an attnc call is:</p>

<p><b>att_val = attnc(file, var_name, att_name);</b></p>

<p>In this case it simply returns the value of a named attribute. You
can use the var_name 'global' to retrieve a global attribute.</p>

<p>The second form of the call is:</p>

<p><b>[att_val, att_name_list] = attnc(file, var_name, att_name);</b></p>

<p>In this case all of the attributes and their names are returned in
cells named att_val and att_name_list.</p>

<p><font face="Albany, sans-serif"><font size="5">Examples</font></font></p>

<p>In the following examples we use our standard OPeNDAP file
test_1.nc.</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get all the
	attributes of a variable</font></font> 
	</p>

  </li>
</ul>

<pre>&gt;&gt; file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; [att_val, att_name_list] = attnc(file, 'u');<br>&gt;&gt; length(att_val)<br>ans =<br> 10<br>&gt;&gt; att_val{1}<br>ans =<br>u,5_januarys<br>&gt;&gt; att_name_list{1}<br>ans =<br>long_name</pre>
<p style="margin-top: 0.42cm; page-break-after: avoid;">
<font face="Thorndale AMT"><font size="3">Here we retrieve all of the
attributes for the variable <i>u. </i>We see that there are 10
elements in each cell and that the first attribute has name <i>long_name</i>
and is a string containing <i>u,5_januarys.</i> </font></font>
</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get all of the
	global attributes</font></font> 
	</p>

  </li>
</ul>

<p style="margin-top: 0.42cm;"><font face="Albany, sans-serif"><font size="4"><font size="3"><font face="Thorndale AMT">By
not giving a variable or attribute name we get information about all
of the global attributes.</font></font> </font></font>
</p>

<pre>&gt;&gt; file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; att_name_list<br>att_name_list = <br> 'source'<br>&gt;&gt; att_val<br>att_val = <br> 'Test program'</pre>
<p>
In this case there is only one global attribute named source and it
is a string containing Test program.</p>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get just one
	attribute of a variable</font></font> 
	</p>

  </li>
</ul>

<p style="margin-top: 0.42cm;"><font face="Thorndale AMT"><font size="3">By
giving the variable and attribute names we can get simply the value
of the attribute.</font></font></p>

<pre>&gt;&gt; [att_val, att_name_list] = attnc(file, 'u', '_FillValue');<br>&gt;&gt; att_val<br>att_val =<br> 1.0000e+16</pre>

<ul>

	<li>
    <p><font size="4"><font face="Albany, sans-serif">Get just one
	global attribute</font></font> 
	</p>

  </li>
</ul>

<p>A single global attribute can be retrieved by using the name
'global' in the call to attnc as below.</p>

<pre>&gt;&gt; [att_val, att_name_list] = attnc(file, 'global', 'source'); <br>&gt;&gt; att_val <br>att_val =<br>Test program</pre>

<hr>
<h1><a name="ddsnc"></a>ddsnc</h1>

<p>ddsnc returns information about a netcdf file or DODS/OPEnDAP
dataset. The general form of a ddsnc call is:</p>

<p>desc = ddsnc(file)</p>

<p>desc is a matlab structure. For an OPEnDAP data set desc will
contain all of the information in the DDS (<a href="http://www.opendap.org/user/guide-html/guide_65.html#id1">Dataset
Description Structure</a>). For a netCDF file desc will be almost
identical. (It cannot be exactly the same since netCDF files are not
identical to OPeNDAP data sets.)</p>

<p><font face="Albany, sans-serif"><font size="5">Examples</font></font></p>

<p>Information about the Reynolds data set can be found as follows:</p>

<pre>&gt;&gt; file = 'http://www.marine.csiro.au/dods/nph-dods/dods-data/test_data/test_1.nc';<br>&gt;&gt; desc = ddsnc(file<br>desc = <br> variable: [1x14 struct]<br> dimension: [1x5 struct]</pre>
<p>
desc has 2 fields - variable and dimension. Looking at one element we
see</p>

<pre>&gt;&gt; desc.variable(2)<br>ans = <br> type: 'Float32'<br> name: 'u'<br> dim_statement: {'depth1 = 12' 'depth2 = 11'}<br> dim_idents: [2x1 double]</pre>
<p>
The first 2 fields tell us that the variable is named 'u' and is a 32
byte float (single precision real). The dim_statement field tells us
that the u variable has 2 dimensions in the order given. For
dim_idents we see</p>

<pre style="margin-bottom: 0.5cm;">&gt;&gt; desc.variable(2).dim_idents<br>ans =<br> 2<br> 3</pre>
<p>
These integers refer to the dimensions of the u array. Looking at
desc.dimension(2) and&nbsp;desc.dimension(3) we see 
</p>

<pre>&gt;&gt; desc.dimension(2)<br>ans = <br> name: 'depth1'<br> length: 12<br>&gt;&gt; desc.dimension(3) <br>ans = <br> name: 'depth2'<br> length: 11</pre>
<p style="margin-bottom: 0cm;">
That is index 2 points us to the 2nd dimension, depth1 and it has
length 12. (We saw the same information in the dim_statement field
earlier.) A generic program could then retrieve the information by
setting:</p>

<pre style="margin-bottom: 0.5cm;">&gt;&gt; ii = desc.variable(2).dim_idents(1);</pre>
<p style="margin-bottom: 0cm;">
and then referring to desc.dimension(ii).</p>

<hr>
<h1><a name="whatnc"></a>whatnc</h1>

<p>whatnc lists all of the netCDF files (including compressed ones)
in the current directory. It also lists all of the netCDF files in
the common data set.</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="5">Example</font></font></p>

<p>Below is a possible listing returned by whatnc.</p>

<pre>&gt;&gt; whatnc<br>----- current directory netCDF files -----<br>bar.cdf foo.cdf mycdf.cdf test_1.nc test_timenc.nc<br>----- current directory compressed netCDF files -----<br>EMPTY<br>----- common data set of netCDF files -----<br>bath_agso_2002.nc soc_climatology.nc<br>bath_agso_98.nc sst.mnmean.1981-present.nc</pre>
<p>
The list under the 1<sup>st</sup> heading shows all of the files in
the current directory that seem to be netCDF files. This is based
simply on whether they end in .cdf or .nc. Note that the .cdf suffix
was used in the past to indicate a netCDF file but is no longet
reccommended.</p>

<p>The list under the 2nd heading shows all of the files that end in
nc.gz, nc.Z, cdf.gz or cdf.Z. These are presumed to be compressed
netCDF files.</p>

<p>The 3<sup>rd</sup> list shows netCDF files in the area referred to
as the common data directory. This directory will be searched by the
inqnc, attnc and getnc commands and is set by the local system
manager. This is done by simply editing the pos_cds.m file.</p>

<hr>
<h1><a name="Installation"></a>Installation</h1>

<p>The interface has been installed on both unix and Windows pc
systems. Installation is mostly a matter of copying the appropriate
files to directories and then making them visible to matlab.
Accordingly the experience should easily translate to other operating
systems.</p>

<ol>

	<li>
    <p>Download either <a href="ftp://ftp.marine.csiro.au/pub/mansbrid/matlab_netCDF_OPeNDAP.tar.gz">matlab_netCDF_OPeNDAP.tar.gz</a>
	or <a href="ftp://ftp.marine.csiro.au/pub/mansbrid/matlab_netCDF_OPeNDAP.zip">matlab_netCDF_OPeNDAP.zip</a>
	(the files in each are identical).</p>

	</li>
  <li>
    <p>Copy the file to where you keep your matlab source code and
	expand it using either gunzip and tar or unzip as appropriate.</p>

	</li>
  <li>
    <p>To be able to read netCDF files you need a version of mexnc
	that suits your operating system. A collection of suitable mex files
	can be found at <a href="http://mexcdf.sourceforge.net/downloads/">http://mexcdf.sourceforge.net/downloads/</a>.
	Note that to use the CSIRO interface it is only necessary to get the
	mex file and put it in your matlab path. The page describes other
	packages that are necessary to install the snctools and netCDF
	toolbox (which are well worth looking at in themselves - see
	<a href="#Alternative">Alternative ways of accessing netCDF and
	OPeNDAP data</a>).</p>

	</li>
  <li>
    <p>To be able to access OPeNDAP files you will need suitable
	copies of the mex and binary files from the <a href="http://www.opendap.org/download/ml-cmdln.html">Matlab
	Command Line Tool</a>
package. There are two versions of this package and the interface will
automatically detect whether you have installed the latest or earlier
version. For the newest version the interface calls a mex file named <i>loaddap</i> which in turn calls a binary
	executable named <i>writedap </i>under linux or <i>writedap.exe&nbsp;</i>under Windows. In the older version these files are
	named <i>loaddods</i> and <i>writeval</i> but do essentially the
	same thing. There are other differences between the linux and Windows versions and these are
	described below.</p>

  </li>
</ol>

<p style="margin-left: 2cm;"><b>Unix users</b></p>

<p style="margin-left: 2cm;">Simply put the appropriate loaddap
mexfile (e.g., <span style="font-style: italic;">loaddap.mexglx</span>) in a directory seen from your matlab
path. The binary file <span style="font-style: italic;">writedap</span> should also be put in the same
directory. (The earlier versions are called <span style="font-style: italic;">loaddods.mex*</span> and <span style="font-style: italic;">writeval</span>.)</p>

<p style="margin-left: 2cm;"><b>Windows users</b></p>

<p style="margin-left: 2cm;">For Windows things are more complicated. From
<a href="http://www.opendap.org/download/ml-cmdln.html">Matlab
Command Line Tool</a> &nbsp;you &nbsp;will need both the Matlab Structs Tool package (with a name like ml-structs3.5.2-win32.zip)
and the libdap library (with a name like
libdap-prerequisites3.7.3.zip). To make things work we
took&nbsp;loaddap.dll and writedap.exe from the first package and put
them into a folder in the matlab
search path. We then copied the dll files from the libdap prerequisite
file to the same folder as the dll's. Earlier versions ofthe Matlab Structs Tool package had things arranged differently and you needed loaddods.dll and writeval.exe. Note that there may be a  <a href="#bug1">bug in the OPeNDAP
interface.</a></p>

<ol start="5">

	<li>
    <p>If you have a local data set of netCDF files that you want to
	be accessible to matlab without the user having to specify the path
	name then you can edit the file pos_cds.m. This matlab function will
	be used by getnc, attnc, timenc, inqnc and whatnc when it is trying
	to find a given netCDF file.</p>

	</li>
  <li>
    <p>When the directory structure was expanded in step 1 a
	subdirectory named test was created. To test the installation go to
	this subdirectory, start matlab and type test_all. This gives you
	options to test both the netCDF and the OPeNDAP installations. It
	does that by reading some data from a supplied netCDF file or from
	an OPeNDAP server. The data are compared to those in a supplied
	mat-file. The most common error is setting up the matlab paths
	incorrectly so that part of the interface is not visible to matlab.
	The testing of the OPeNDAP installation <span style="text-decoration: none;">may</span>
	fail sometimes because of dropouts in the internet somewhere.</p>

	
    <p>If you get to the end successfully then test_all will give you a
	timing message. It is interesting to see how much slower it can be
	to access the data remotely via the OPeNDAP interface. 
	</p>

  </li>
</ol>

<p style="margin-left: 2cm;"><b>Note that when testing the OPeNDAP
installation on a Windows PC there may be a number of warning
messages. These are because of the </b><a href="#bug1"><b>bug
described here</b></a><b>. If you get to the timing message then
things have worked except for the known bug.</b></p>

<hr>
<h1><a name="Portability"></a>Portability and known problems</h1>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">Portability</font></font></p>

<p>The software in this package is entirely made up of matlab script
files and works for all versions of matlab later than and including
matlab 6.1 (R12). Portability problems can arise with the binary
files mexnc, loaddap and writedap which must be downloaded from
elsewhere.</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">Bugs</font></font></p>

<p><a name="bug1"></a>There are no known bugs.</p>

<p>(Before version 3.22 there was be a problem on Windows PCs and
some linux boxes when using OPeNDAP . The package could give the
wrong result when reading variables which are character arrays. The
problem is with the loaddap (loaddods) mex file and will presumably
be fixed sometime in the future. At present there is a workaround in
the timenc and getnc_s functions.)</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><a name="Confusion"></a>
<font face="Albany, sans-serif"><font size="4">Confusion with missing
values</font></font></p>

<p>When reading some netCDF files getnc will return a missing value
indicator (by default a NaN) in some places where there shouldn't be
one. This is not due to a bug in getnc but occurs when the netCDF
file is not following the attribute conventions (see
<a href="http://www.unidata.ucar.edu/software/netcdf/docs/netcdf.html#Attribute-Conventions">http://www.unidata.ucar.edu/software/netcdf/docs/netcdf.html#Attribute-Conventions</a>).
Two relevant quotes from the documentation are:</p>

<pre style="margin-bottom: 0.5cm;">The type of each valid_range, valid_min and valid_max attribute should match the type of its variable<br>(except that for byte data, these can be of a signed integral type to specify the intended range).</pre>
<p>
and</p>

<pre style="margin-bottom: 0.5cm;">If _FillValue is defined then it should be scalar and of the same type as the variable.</pre>
<p>
To illustrate what this means and how a problem can occur consider
the following extract from an example cdl file.</p>

<pre>short airtemp(time, lat, lon) ;<br> airtemp:long_name = "Air temperature at surface" ;<br> airtemp:valid_range = -10000s, 10000s ;<br> airtemp:units = "degC" ;<br> airtemp:scale_factor = 0.01f ;<br> airtemp:_FillValue = 32766s ;</pre>
<p>
What has happened here is that the creator of the netCDF file has
chosen to save space by storing the data as shorts (2 byte integers).
The software reading the data will then multiply the add_offset of
0.01 by the integer values to produce the floating point value of the
air temperature. Since the integers can take values between -32768
and 32767 then this can represent temperatures of between -327.68 and
327.67 degrees with a resolution of 0.01 degrees.</p>

<p>Note, however, that the valid_range goes from -10000 to 10000.
Generic software interprets values outside of this range as faulty in
some way and the default behaviour of getnc is to replace such values
with a NaN. The creator of the file can use this to mark missing or
contaminated data. Since the temperatures implied by these limits are
-100 and 100 Celsius then the limits are &ldquo;safe&rdquo; since they
represent physically unreasonable data.</p>

<p>This way of defining the valid_range is what is specified in the
earlier quote.</p>

<p>A problem arises when the creator of the netCDF file
misunderstands the attribute convention. They choose an &ldquo;intuitive&rdquo;
definition of the attribute like:</p>

<pre style="margin-bottom: 0.5cm;">airtemp:valid_range = -100.0f, 100.0f ;</pre>
<p>
Here they are thinking in terms of the true air temperature rather
than the scaled version stored as integers. When getnc reads the
valid_range attribute it then multiplies it by 0.01 and concludes
that any temperatures outside the range of -1.0 to 1.0 are to be
replaced by NaNs. Note that the same problem&nbsp;occurs when the
file's creator makes the same error with other attributes &ndash;
valid_min, valid_max, _<span style="text-decoration: none;">FillValue
and missing_value.</span></p>

<p>There are several workarounds for this problem. The simplest is to
pass getnc the argument <i>change_miss</i> = 1. This will cause all
values to be passed unchanged (apart from the rescaling implied by
the scale_factor attribute). The disadvantage is that when very large
values were used to indicate faulty data these will also be returned
- in the example above you might end up with some temperatures
greater than 100C.</p>

<p>The trickier, but more satisfactory option, it to use the
<i>rescale_opts </i>option in getnc. It was designed to deal with
errant netCDF files and is described <a href="#rescale_opts">here</a>.</p>

<hr>
<h1><a name="Revision"></a>Revision history</h1>

<p>The following is a partial history of revisions. I intend to keep
it more up-to-date from version 3.0 onwards. In particular, bug fixes
will be recorded.</p>

<ul>

	<li>
    <p><i><b>Version 3.33 :&nbsp;</b><span style="">January 12 2007:</span></i><span style=""><span style="font-style: normal;">
	Handles&nbsp;the latest version of the Matlab Struct Tools under Windows (loaddap.dll, etc).</span></span></p>
  </li>
  <li>
    <p><i><b>Version 3.32 : </b><span style="">December
	4 2006:</span></i><span style=""><span style="font-style: normal;">
	get_dods_dds can now deal with spaces in directory names under
	windows.</span></span></p>
  </li>
</ul>

<ul>

	<li>
    <p><b><i>Version 3.31</i></b> : November 29 <i>2006</i>: timenc
	can handle more calendar types.</p>

	</li>
  <li>
    <p><b><i>Version 3.30</i></b> : June 30 <i>2006</i>: getnc error
	handling and input method made more versatile.</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><b><i>Version 3.22</i></b> : April
	<i>24 2006</i>: Minor changes to timenc and getnc_s to work around a
	bug in loaddods (and maybe loaddap) which cause errors when
	retrieving an array of characters. 
	</p>

	</li>
  <li>
    <p><b><i>Version 3.21</i></b> : <i>January 27 2006</i>: Minor
	changes were made to enable it the work properly on matlab 6.1
	(R12).</p>

	</li>
  <li>
    <p><b><i>Version 3.2</i></b> : <i>December 19 2</i>005: The new
	function ddsnc was added to the interface.</p>

	</li>
  <li>
    <p><b><i>Version 3.1</i></b> : <i>December 6 2</i>005: Handles
	OPeNDAP files other than those that are native netCDF files; works
	(mostly) on windows boxes.</p>

	</li>
  <li>
    <p><b><i>Version 3.01</i></b> : <i>October 27</i> 2005: Bug fix;
	it caused attnc to fall over when 3 input arguments were passed for
	an OPeNDAP file.</p>

  </li>
</ul>

<ul>

	<li>
    <p><i><b>Version 3.0</b> : October 24</i> 2005: Able to access
	OPeNDAP data sets as well as netCDF ones. Calls mexnc. Minor bug fix
	in fill_var.m.</p>

	</li>
  <li>
    <p><i><b>Version 2.4</b> : July 3 2000: </i>timenc was
	generalised so that it could handle dates before the introduction of
	the Gregorian calendar on October 15, 1582; it now works back to the
	year -4712. The earlier version could give incorrect dates for files
	which used the pre-Gregorian calendar in either the time vector
	values or in its 'units' attribute. 
	</p>

	</li>
  <li>
    <p style="margin-bottom: 0cm;"><i><b>Version 2.3 </b>: April 22
	1998: </i>timenc was generalised so that when requested it will
	return only part of the time vector. It can also return the length
	of the time vector as a separate variable. 
	</p>

	</li>
  <li>
    <p><i><b>Version 2.2</b> : December 12 1997:</i> attnc was
	generalised so that when the user does not specify the name of the
	variable's attribute then all of the attributes (and their names)
	will be returned in cells. 
	</p>

	</li>
  <li>
    <p><i><b>Version 2.1</b> : September 24 1997: </i>Explanatory
	web page first made public.</p>

	</li>
  <li>
    <p style="font-style: normal;"><i><b>Version 2.0</b> : April 28
	1997: </i>Functions renamed to getnc, timenc, etc.</p>

	</li>
  <li>
    <p style="font-style: normal;"><i><b>Version 1.0</b>: June 1
	1993: </i>Initial release.</p>

  </li>
</ul>

<hr>
<h1><a name="Alternative"></a>Alternative ways of accessing netCDF
and OPeNDAP data</h1>

<p>There are a number of alternative ways of reading netCDF and
OPeNDAP data into matlab. In most cases the time and computer
resources taken to retrieve data will depend mostly on external
factors such as internet bandwidth and disk access speed. Hence it
would be surprising if one of these methods was significantly more
efficient than any of the others.</p>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">netCDF</font></font></p>

<ul>

	<li>
    <p><a href="http://mexcdf.sourceforge.net/snctools_overview.html">snctools</a>
	is a set of matlab functions that lets you read and write netCDF
	files. It uses mexnc for basic access to netCDF libraries.</p>

  </li>
</ul>

<ul>

	<li>
    <p><a href="http://mexcdf.sourceforge.net/netcdf_toolbox.html">netCDF
	toolbox</a> is an object-oriented way to read and write netCDF files
	and is neat to use once you figure out what is going on. It is being
	maintained but no longer developed.</p>

  </li>
</ul>

<p style="margin-top: 0.42cm; page-break-after: avoid;"><font face="Albany, sans-serif"><font size="4">OPeNDAP</font></font></p>

<ul>

	<li>
    <p><a href="http://www.opendap.org/download/ml-cmdln.html">Matlab
	Command Line Tool </a>is a low-level interface to OPeNDAP data.</p>

  </li>
</ul>

<ul>

	<li>
    <p><a href="http://opendap.org/user/mgui-html/index.html">OPeNDAP
	Matlab Graphical User Interface</a> is a friendly GUI for reading
	OPeNDAP data.</p>

  </li>
</ul>

<hr>
<h1><a name="Disclaimer"></a>Disclaimer</h1>

<p>This software is provided "as is" without warranty of
any kind. It is covered by a general <a href="http://www.csiro.au/legalnotices/disclaimer.html">CSIRO
Legal Notice and Disclaimer</a>.</p>

<hr>
<h1><a name="People"></a>People involved in the development of the
interface</h1>

<p>The CSIRO matlab interface has been mostly written by Jim
Mansbridge with some input from Peter McIntosh and Rose O'Connor (all
of CSIRO).</p>

<p>Early versions of a mex file interface to netCDF (called xnetcdf)
were worked on by Peter McIntosh and Jim Mansbridge. A series of much
improved versions were created by Chuck Denham (USGS); these had
names like mexcdf, mexcdf53 and ncmex. John Evans (Rutgers) has then
developed the code further as mexnc and now maintains the project.</p>

<p>The Matlab Command Line Tool (from which loaddap and writedap are
taken) was written by Glenn Flierl (MIT) and James Gallagher (URI).</p>

<hr>
<h1><a name="Contact"></a>Contact details</h1>

<p>This web page is maintained by Jim Mansbridge, CSIRO Marine and
Atmospheric Research.</p>

<p><b>Postal address:</b> GPO Box 1538, Hobart, Tasmania 7001,
Australia<br>
<b>Phone:</b> +61-3-62 32 5416 <br>
<b>Fax:</b> +61-3-62
32 5123</p>

<p align="left"><img src="http://www.marine.csiro.au/%7Emansbrid/jmaddress1.gif" name="graphics1" align="bottom" border="0" height="29" width="287"></p>

<hr>
<p style="margin-bottom: 0cm;">This page is
<a href="http://www.marine.csiro.au/sw/matlab-netcdf.html">http://www.marine.csiro.au/sw/matlab-netcdf.html</a>.
</p>

<hr>
<p style="margin-bottom: 0cm;">Visitors since 27 October 2005:&nbsp;<!--#include virtual="/cgi-bin/hits"-->
</p>

<hr>
<p style="margin-bottom: 0cm;">Last revised by Jim Mansbridge on&nbsp;12/01/07 
</p>

<hr>
<p align="left">Further details on the research of the CSIRO Marine and
Atmospheric Research are available through the <a href="http://www.cmar.csiro.au/">CMAR
Home Page</a>.</p>

<p align="left">For more information contact reception@marine.csiro.au
or telephone +61-3-62325222. Unless otherwise indicated all contents
in these web documents are copyright &copy; 1997 CSIRO. 
</p>

</body>
</html>
